title: SeriousSAM MS PowerShell Exploit Attempt
id: 30f34820-89d3-11ec-a8a3-0242ac120002
description: This rule detects attempts to dump SAM,SYSTEM,SECURITY objects using MS PowerShell.
author: Tim (Bobby_Tablez) Peck
status: experimental
date: 2021/09/19
modified: 2022/02/10
references:
    - https://www.fortify24x7.com/2021/07/cve-2021-36934-hivenightmare/
    - https://github.com/clymb3r/PowerShell/blob/master/Invoke-NinjaCopy/Invoke-NinjaCopy.ps1
tags:
    - attack.T1003
    - attack.T1003.003
    - attack.os_credential_dumping
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|re:
      - '(?i).*\[System\.IO\.File\]\:\:(\s+)?Copy.*\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\Windows\\System32\\config\\(SYSTEM|SECURITY|SAM|\$\w)'
      - '(?i).*Invoke\-NinjaCopy\s+\-Path
  condition: selection
falsepositives:
  - Unlikely
level: high